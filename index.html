<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0" />
    <meta name="flattr:id" content="9ykjj0" />
    <meta name="keywords" content="fire, emblem, heroes, feh, gacha, favorite, picker, sorter, pick, sort, game, games" />
    <link href="/favicon.png" rel="shortcut icon" type="image/png" />
    <title>FEHvorite Unit Picker</title>
    <style>
      body {
        background: #00e1ff;
        color: #000;
        font-family: verdana, sans-serif;
        font-size: 10pt;
        margin: 0;
        padding: 10px;
      }

      a:link,
      a:visited {
        color: #008;
        font-weight: bold;
        text-decoration: none;
      }

      a:active,
      a:hover {
        color: #acf;
      }

      .info {
        font-weight: bold;
      }

      button {
        font-family: inherit;
        cursor: pointer;
        border: 0;
        border-radius: 3px;
        padding: 0.3em 0.5em;
        background: #ccc;
        color: #000;
      }

      button:hover,
      button:active,
      button:focus {
        background: #ddd;
        outline: none;
      }

      button.disabled {
        background: #ddd;
        color: #888;
        cursor: not-allowed;
      }

      button.disabled:hover {
        background: #ddd;
      }

      #container {
        position: relative;
        margin-left: -10px;
        margin-right: -10px;
        padding: 10px;
      }
      /* overflow: hidden; */

.background img {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 1;
}

.main-image img {
  position: relative;
  z-index: 2;
  width: 90%;
  height: 90%;
  object-fit: contain;
}
/*I'd eventually like to get the 90% to target ONLY portrait mode*/

.frame img {
  position: absolute;
  top: 0;
  left: 0;
  z-index: 3;
  width: 100%;
  height: 100%;
  pointer-events: none; /* Makes sure clicks pass through to the main image */
}

      .tabs {
        margin: 20px 0;
        padding: 0 10px;
        list-style-type: none;
        border-bottom: 1px solid #aaa;
      }

      .tabs li {
        margin: 0 -1px -1px 0;
        padding: 0;
        display: inline-block;
        vertical-align: bottom;
        border: 1px solid #aaa;
        background: #eee;
      }

      .tabs li:first-child {
        border-top-left-radius: 5px;
      }

      .tabs li:last-child {
        border-top-right-radius: 5px;
      }

      .tabs li.active {
        border-top-left-radius: 5px;
        border-top-right-radius: 5px;
        background: #fff;
        border-bottom-color: #fff;
      }

      .tabs a {
        display: block;
        padding: 5px 10px;
        font-size: 1.1em;
        color: #000;
      }

      .tabs li.active a {
        font-size: 1.2em;
        padding: 10px 20px 5px;
      }

      #expand-favorites {
        display: none;
      }

      @media (min-width: 360px) {
        .tabs a {
          font-size: 1.3em;
        }

        .tabs li.active a {
          font-size: 1.5em;
        }
      }

      @media (min-width: 1024px) {
        /* Put the found favorites beside the picking div when the window is sufficiently large */
        #picking {
          float: left;
          width: 636px;
        }

        #secondary {
          margin-left: 646px;
        }

        #secondary,
        #picking {
          transition: margin-left 0.4s;
        }

        #picking.collapsed {
          margin-left: -100%;
          z-index: -1;
        }

        #secondary.expanded {
          margin-left: 0;
        }

        #expand-favorites {
          display: inline-block;
        }

        .tabs {
          padding-left: 0;
        }
      }

      @media (min-width: 1300px) {
        /* Once we get to the point where 636px is less than half of the width of the screen, make the picking div just take up half */
        #picking {
          width: 50%;
        }

        #secondary {
          margin-left: 51%;
        }
      }

      #pick {
        background: #58f;
        color: #fff;
        font-size: larger;
        font-weight: bold;
        width: 6em;
        border-radius: 5px;
        margin-right: 10px;
      }

      #pick.disabled {
        background: #acf;
      }

      #pick:hover {
        background: #acf;
      }

      .item-list {
        padding: 0;
        list-style-type: none;
        line-height: 100px;
      }

      .item-list li {
        margin: 0;
        display: inline-block;
        border: 3px solid transparent;
        text-align: center;
        position: relative;
        vertical-align: top;
        overflow: visible;
      }

      .item-list li span {
        display: inline-block;
        width: 100px;
        height: 100px;
        padding: 3px;
        border-radius: 100%;
      }

      .item-list li img {
        margin-left: auto;
        margin-right: auto;
        height: 100px;
        z-index: 100;
      }

      /* .portrait-img {
       height: 75%;
      }

      .full-img {
        height: 100px
      } */


      @media (max-width: 656px) {
        #units.item-list {
          width: 100%;
          max-width: 100%;
        }

        .item-list {
          line-height: 95px;
        }

        .item-list li {
          height: 101px;
          width: 101px;
        } */

        .item-list li span {
          height: 95px;
          width: 95px;
          padding: 3px;
        }

        .item-list li img {
          top: -2px;
          left: -2px;
          max-height: 101px;
          max-width: 101px;
        }

        /* .item-list {
          line-height: 75px;
        } */

        /* .item-list li {
          height: 81px;
          width: 81px;
        } */

        /* .item-list li span {
          height: 75px;
          width: 75px;
          padding: 3px;
        } */

        /* .item-list li img {
          top: -2px;
          left: -2px;
          max-height: 81px;
          max-width: 81px;
        } */
      }

      #updates-background {
        padding: 1%;
        margin: 1%;
      }

      @media (max-width: 456px) {

        .item-list {
          line-height: 75px;
        }

        .item-list li {
          height: 81px;
          width: 81px;
        }

        .item-list li span {
          height: 75px;
          width: 75px;
          padding: 3px;
        }

        .item-list li img {
          top: -2px;
          left: -2px;
          max-height: 81px;
          max-width: 81px;
        }
        
        /* .item-list {
          line-height: 48px;
        } */

        /* .item-list li {
          height: 54px;
          width: 54px;
        } */

        /* .item-list li span {
          height: 48px;
          width: 48px;
          padding: 3px;
        } */

        /* .item-list li img {
          top: -1px;
          left: -1px;
          max-height: 54px;
          max-width: 54px;
        } */
      }

      #units li {
        cursor: pointer;
      }

      #favorites li {
        cursor: move;
        transition: opacity 0.2s ease-in;
      }

      #favorites li.hidden {
        opacity: 0;
      }

      #favorites li.no-animate {
        transition: none;
      }

      .item-list li:hover span {
        background: #cdf;
      }

      .item-list.sorting li:hover span {
        background: #f7f7f7;
      }

      #units li.selected span {
        padding: 0;
        border: 3px solid #7ac;
      }

      #units,
      #buttons {
        text-align: center;
        margin: auto;
      }

      #units li.notice {
        width: auto;
        height: auto;
        max-width: 260px;
        margin: auto;
        background: #f7f7f7;
        border-radius: 10px;
        padding: 30px 30px;
        color: #000;
        text-align: center;
        line-height: 1.4;
        cursor: auto;
      }

      #units li.notice span {
        display: inline;
        background: none;
        width: auto;
        height: auto;
        padding: 0;
        border-radius: 0;
      }

      #buttons {
        margin-top: 30px;
        position: relative;
        z-index: 3;
      }

      #howitworks,
      #debug,
      #game-toggle
       {
        display: none;
        overflow: hidden;
      }

      #debug-toggle {
        margin-top: 3em;
        font-size: smaller;
        text-align: right;
      }

      #debug {
        font-size: smaller;
      }

      #debug-state {
        width: 80%;
      }

      #max-batch-size {
        width: 3em;
      }

      .picker-info {
        text-align: center;
        font-size: smaller;
      }

      #progress-bar {
        display: block;
        margin: auto;
        height: 15px;
        width: 150px;
        margin-top: 5px;
        background: #cdf;
        vertical-align: middle;
        transition: transform 0.2s ease-out;
      }

      #progress-bar span {
        display: block;
        height: 100%;
        width: 0;
        background: #58f;
      }

      .help-text {
        display: block;
        font-size: smaller;
      }

      .hide-help {
        display: none;
      }

      #shared-list-modal {
        position: absolute;
        background: #fff;
        margin: 60px auto;
        top: 0;
        right: 0;
        left: 0;
        width: 650px;
        max-width: 95%;
        box-sizing: border-box;
        padding: 20px 50px 50px;
        box-shadow: 1px 1px 5px #333;
        z-index: 100;
      }

      @media (max-width: 700px) {
        #shared-list-modal {
          padding: 20px;
        }
      }

      #shared-list-modal:before {
        content: "";
        position: fixed;
        background: #fff;
        opacity: 0.5;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        z-index: -1;
      }

      #shared-list-modal .item-list {
        text-align: center;
        margin: 2em 0;
      }

      #shared-list-modal .close {
        position: absolute;
        top: 10px;
        right: 10px;
        width: 30px;
        line-height: 30px;
        color: #aaa;
        font-weight: bold;
        text-align: center;
        background: none;
        padding: 0;
        font-size: larger;
      }

      #shared-list-modal .close:hover {
        background: #eee;
      }

      #shared-list-modal .buttons {
        text-align: center;
        line-height: 3.5em;
      }

      #shared-list-modal button {
        padding: 0.9em 2em;
        margin: 0 0.2em;
      }

      #darkmode {
        position: absolute;
        top: 10px;
        right: 10px;
      }

      #testId {
        opacity: 0.4;
        filter: alpha(opacity=40); /* msie */
      }

.hideCheckbox {
  display: none
}

.hideCheckbox ~ img {
  filter: grayscale(100%);
  transition: filter 0.3s ease;
  opacity: .5;
}

.hideCheckbox:checked ~ img {
    filter: grayscale(0%);
    transition: filter 0.3s ease;
    opacity: 1;
}

      .orb {
        height: 38px;
      }

      .container{
        position: relative;
        text-align: center;
      }

      /* .image-wrapper {
        position: relative;
        width: fit-content;
        height: fit-content;
        text-align: center;
      } */

      .floatText{
        color: white;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        display: inline-block;
      }

    </style>

    <link
      rel="alternate stylesheet"
      title="dark"
      type="text/css"
      href="styles/favorite-dark.css"
    />
    
    <script type="text/javascript">
      /* STYLE SWITCHER */

      function setActiveStyleSheet(title) {
        var i, a, main;
        for (i = 0; (a = document.getElementsByTagName("link")[i]); i++) {
          if (
            a.getAttribute("rel").indexOf("style") != -1 &&
            a.getAttribute("title")
          ) {
            a.disabled = true;
            if (a.getAttribute("title") == title) a.disabled = false;
          }
        }
        localStorage.setItem("favorite-style", title);
      }

      function getActiveStyleSheet() {
        var i, a;
        for (i = 0; (a = document.getElementsByTagName("link")[i]); i++) {
          if (
            a.getAttribute("rel").indexOf("style") != -1 &&
            a.getAttribute("title") &&
            !a.disabled
          )
            return a.getAttribute("title");
        }
        return null;
      }

      function getPreferredStyleSheet() {
        var i, a;
        for (i = 0; (a = document.getElementsByTagName("link")[i]); i++) {
          if (
            a.getAttribute("rel").indexOf("style") != -1 &&
            a.getAttribute("rel").indexOf("alt") == -1 &&
            a.getAttribute("title")
          )
            return a.getAttribute("title");
        }
        return null;
      }

      var style = localStorage.getItem("favorite-style");
      var title = style;
      setActiveStyleSheet(title);
    </script>
    <!-- <script>
      //⚠️current working for individual checkboxes but not with the setSelectAll function
      //getting the checkboxless-checkboxes to change images depending on checked or unchecked
      //based on https://stackoverflow.com/questions/5395235/change-text-of-corresponding-label-when-checkbox-is-checked-unchecked
      function displayCheckedStatus(checkboxId, labelId) {
        const checkBox = document.getElementById(checkboxId);
        const labelIdVar = document.getElementById(labelId);
        console.log(checkBox.checked);
          if (!checkBox.checked) {
            labelIdVar.innerHTML= `<img src="static/images/${checkBox.id}-unchecked.png" alt="${checkBox.id} checkbox" class="optionsCheckboxImg"/>`;
        } else {
          labelIdVar.innerHTML= `<img src="static/images/${checkBox.id}.png" alt="${checkBox.id} checkbox" class="optionsCheckboxImg"/>`;
        }}
    </script> -->

  </head>
  <body>
    <a href="#" id="darkmode">Light mode</a>
    <h1>
      FEHvorite Unit Picker
    </h1>
    <p>Version 1.2: cleaner visuals in "filters" tab</p>
    <H2></H2>

    <p>Find and sort your favorite Fire Emblem Heroes
      units!</p>
    <p>If you haven't used a picker before and need help getting started, check out
      the "Picker Explanation" tab. Please visit the "Filters" and "Display Options" tabs to improve your experience.</p>

    <!-- <div id="howitworks"></div> -->

    <div id="container">
      <div id="picking">
        <ul id="units" class="item-list" style="opacity: 1; width: 560px"></ul>

        <p id="buttons">
          <button id="pick">Pick</button> <button id="pass">Pass</button>
          <button id="undo" class="disabled">Undo</button>
          <button id="redo" class="disabled">Redo</button>
        </p>

        <div class="picker-info">
          <p>
            Units remaining to be eliminated before next favorite is found:
            <span id="remaining">1237</span>
          </p>

          <p>
            Progress towards next favorite:
            <span id="progress-bar"><span style="width: 0%"></span></span>
          </p>
          <p><button class="reset">Reset</button></p>
        </div>
      </div>

      <div id="secondary">
        <ul class="tabs">
          <li id="expand-favorites"><a href="#" title="Expand list">‹</a></li>
          <li class="active"><a href="#found-favorites">Found Favorites</a></li>
          <li><a href="#filters">Unit Filters</a></li>
          <li><a href="#options">Display Options</a></li>
          <li><a href="#explanation">Picker Explanation</a></li>
          <!-- <li><a href="#updates">Update Log</a></li> -->
        </ul>

        <div id="found-favorites" style="display: block">
          <p class="state-info">
            None yet! Your favorites will start appearing here when you've
            narrowed things down.
          </p>
          <ol id="favorites" class="item-list"></ol>

          <p id="debug-toggle">
            <a href="#debug" class="toggle">Import/export state</a>
          </p>

          <div id="debug">
            <p>
              To export your picker state (in order to, for example, import it
              on another computer, or allow me to replicate an issue you're
              experiencing), copy the entire contents of the text box below and
              save them however you see fit - in a text file on your computer,
              in an e-mail to yourself, etc.
            </p>

            <p>
              To import a state, erase the entire contents of the text box and
              replace them with an exported state, then press the "Import state"
              button below.
            </p>

            <textarea id="debug-state" rows="5" cols="10"></textarea>
            <p><button id="import">Import state</button></p>
          </div>
        </div>
        <!-- end found favorites -->
        <!-- start filters -->
        <div id="filters" style="display: none">

          <p>Weapon types to include:</p>
          <p>
            <label>
              <input
                type="checkbox"
                id="weaponTypes-all"
                class="select-all hideCheckbox"
                value="weaponTypes"
              />
              <img src="static/images/select-all-select-all.png" alt="select all" class="orb"></label>
            <label>
              <input
                type="checkbox"
                class="weaponTypes hideCheckbox"
                id="weapon-melee-sword"
                value="sword"
                onload="displayCheckedStatus('weapon-melee-sword','swordId');"
                onchange="displayCheckedStatus('weapon-melee-sword','swordId');"
                checked />
                <img src="static/images/weapon-melee-sword.png" alt="sword icon" title="sword" class="filterImg"/>
            </label>
            <label
              ><input
                type="checkbox"
                class="weaponTypes hideCheckbox"
                id="weapon-melee-lance"
                value="lance"
                onclick="displayCheckedStatus('weapon-melee-lance','lanceId');"
                checked="" />
                <img src="static/images/weapon-melee-lance.png" alt="lance icon" title="lance"/>
            </label>
            <label>
              <input
                type="checkbox"
                class="weaponTypes hideCheckbox"
                id="weapon-melee-axe"
                value="axe"
                onclick="displayCheckedStatus('weapon-melee-axe','axeId');"
                checked="" />
                <img src="static/images/weapon-melee-axe.png" alt="axe icon" title="axe"/>
            </label>
            <label
              ><input
                type="checkbox"
                class="weaponTypes hideCheckbox"
                id="weapon-staff"
                value="staff"
                onclick="displayCheckedStatus('weapon-staff','staffId');"
                checked="" />
                <img src="static/images/weapon-staff.png" alt="staff icon" title="staff"/>
            </label>
            <label>
              <input
                type="checkbox"
                class="weaponTypes hideCheckbox"
                id ="weapon-tome-red"
                value="dark"
                onclick="displayCheckedStatus('weapon-tome-red','darkId');"
                checked="" />
              <img src="static/images/weapon-tome-red.png" alt="red tome icon" title="red tome"
            /></label>
            <label>
              <input type="checkbox" class="weaponTypes hideCheckbox" id="weapon-tome-blue" value="light" onclick="displayCheckedStatus('weapon-tome-blue','lightId');" checked="" />
                <img src="static/images/weapon-tome-blue.png" alt="blue tome icon"/>
            </label>
            <label>
              <input type="checkbox"
              class="weaponTypes hideCheckbox"
              id="weapon-tome-green"
              value="anima"
              onclick="displayCheckedStatus('weapon-tome-green','animaId');"
              checked="" />
                <img src="static/images/weapon-tome-green.png" alt="green tome icon" title="green tome"/>
            </label>
            <label>
              <input
                type="checkbox"
                class="weaponTypes hideCheckbox"
                id="weapon-tome-colorless"
                value="tome"
                onclick="displayCheckedStatus('weapon-tome-colorless','tomeId');"
                checked="" />
                <img src="static/images/weapon-tome-colorless.png" alt="colorless tome icon" title="colorless tome"/>
            </label>
            <label>
              <input
                type="checkbox"
                class="weaponTypes hideCheckbox"
                id="weapon-bow-red"
                value="bow red"
                onclick="displayCheckedStatus('weapon-bow-red','bowRedId');"
                checked="" />
                <img src="static/images/weapon-bow-red.png" alt="red bow icon" title="red bow"/>
            </label>
            <label>
              <input
                type="checkbox"
                class="weaponTypes hideCheckbox"
                id="weapon-bow-blue"
                value="bow blue"
                onclick="displayCheckedStatus('weapon-bow-blue','bowBlueId');"
                checked="" />
                <img src="static/images/weapon-bow-blue.png" alt="blue bow icon" title="blue bow"/>
            </label>
            <label>
              <input
                type="checkbox"
                class="weaponTypes hideCheckbox"
                id="weapon-bow-green"
                value="bow green"
                onclick="displayCheckedStatus('weapon-bow-green','bowGreenId');"
                checked="" />
                <img src="static/images/weapon-bow-green.png" alt="green bow icon" title="green bow"/>
            </label>
            <label>
              <input
                type="checkbox"
                class="weaponTypes hideCheckbox"
                id="weapon-bow-colorless"
                value="bow colorless"
                onclick="displayCheckedStatus('weapon-bow-colorless','bowColorlessId');"
                checked="" />
                <img
                  src="static/images/weapon-bow-colorless.png"
                  alt="colorless bow icon"
                  title="colorless bow"
                />
            </label>
            <label>
              <input
                type="checkbox"
                class="weaponTypes hideCheckbox"
                id="weapon-dagger-red"
                value="dagger red"
                onclick="displayCheckedStatus('weapon-dagger-red','daggerRedId');"
                checked="" />
                <img
                  src="static/images/weapon-dagger-red.png"
                  alt="red dagger icon"
                  title="red dagger"
                />
            </label>
            <label
              ><input
                type="checkbox"
                class="weaponTypes hideCheckbox"
                id="weapon-dagger-blue"
                value="dagger blue"
                onclick="displayCheckedStatus('weapon-dagger-blue','daggerBlueId');"
                checked="" />
                <img
                  src="static/images/weapon-dagger-blue.png"
                  alt="blue dagger icon"
                  title="blue dagger"
                />
            </label>
            <label
              ><input
                type="checkbox"
                class="weaponTypes hideCheckbox"
                value="dagger green"
                id="weapon-dagger-green"
                onclick="displayCheckedStatus('weapon-dagger-green','daggerGreenId');"
                checked="" />
                  <img
                    src="static/images/weapon-dagger-green.png"
                    alt="green dagger icon"
                    title="green dagger"
                  />
            </label>
            <label>
              <input
                type="checkbox"
                class="weaponTypes hideCheckbox"
                id="weapon-dagger-colorless"
                value="dagger colorless"
                onclick="displayCheckedStatus('weapon-dagger-colorless','daggerColorlessId');"
                checked="" />
                <img
                  src="static/images/weapon-dagger-colorless.png"
                  alt="colorless dagger icon"
                  title="colorless dagger"
                />
            </label>
            <label>
              <input
                type="checkbox"
                class="weaponTypes hideCheckbox"
                id="weapon-beast-red"
                value="beast red"
                onclick="displayCheckedStatus('weapon-beast-red','BeastRedId');"
                checked="" />
                <img
                src="static/images/weapon-beast-red.png"
                alt="red beast icon"
                title="red beast"
                />
            </label>
            <label
              ><input
                type="checkbox"
                class="weaponTypes hideCheckbox"
                value="beast blue"
                onclick="displayCheckedStatus('weapon-','Id');"
                checked="" />
              <img
                src="static/images/weapon-beast-blue.png"
                alt="blue beast icon"
                title="blue beast"
            /></label>
            <label
              ><input
                type="checkbox"
                class="weaponTypes hideCheckbox"
                value="beast green"
                onclick="displayCheckedStatus('weapon-','Id');"
                checked="" />
              <img
                src="static/images/weapon-beast-green.png"
                alt="green beast icon"
                title="green beast"
            /></label>
            <label
              ><input
                type="checkbox"
                class="weaponTypes hideCheckbox"
                value="beast colorless"
                onclick="displayCheckedStatus('weapon-','Id');"
                checked="" />
              <img
                src="static/images/weapon-beast-colorless.png"
                alt="colorless beast icon"
                title="colorless beast"
            /></label>
            <label
              ><input
                type="checkbox"
                class="weaponTypes hideCheckbox"
                value="dragon red"
                onclick="displayCheckedStatus('weapon-','Id');"
                checked="" />
              <img
                src="static/images/weapon-dragon-red.png"
                alt="red dragon icon"
                title="red dragon"
            /></label>
            <label
              ><input
                type="checkbox"
                class="weaponTypes hideCheckbox"
                value="dragon blue"
                onclick="displayCheckedStatus('weapon-','Id');"
                checked="" />
              <img
                src="static/images/weapon-dragon-blue.png"
                alt="blue dragon icon"
                title="blue dragon"
            /></label>
            <label
              ><input
                type="checkbox"
                class="weaponTypes hideCheckbox"
                value="dragon green"
                onclick="displayCheckedStatus('weapon-','Id');"
                checked="" />
              <img
                src="static/images/weapon-dragon-green.png"
                alt="green dragon icon"
                title="green dragon"
            /></label>
            <label
              ><input
                type="checkbox"
                class="weaponTypes hideCheckbox"
                value="dragon colorless"
                onclick="displayCheckedStatus('weapon-','Id');"
                checked="" />
              <img
                src="static/images/weapon-dragon-colorless.png"
                alt="colorless dragon icon"
                title="colorless dragon"
            /></label>
          </p>

          <p>Movement types to include:</p>
          <p>
            <label
              ><input
                type="checkbox"
                id="moveTypes-all"
                class="select-all hideCheckbox"
                value="moveTypes"
              />
              <img src="static/images/select-all-select-all.png" alt="select all" class="orb"></label
            >
            <label
              ><input
                type="checkbox"
                class="moveTypes hideCheckbox"
                value="infantry"
                checked="" />
              <img
                src="static/images/move-infantry.png"
                alt="infantry movement icon"
                title="infantry"
            /></label>
            <label
              ><input
                type="checkbox"
                class="moveTypes hideCheckbox"
                value="armored"
                checked="" />
              <img
                src="static/images/move-armored.png"
                alt="armored movement icon"
                title="armored"
            /></label>
            <label
              ><input
                type="checkbox"
                class="moveTypes hideCheckbox"
                value="cavalry"
                checked="" />
              <img
                src="static/images/move-cavalry.png"
                alt="cavalry movement icon"
                title="cavalry"
            /></label>
            <label
              ><input
                type="checkbox"
                class="moveTypes hideCheckbox"
                value="flying"
                checked="" />
              <img
                src="static/images/move-flying.png"
                alt="flying movement icon"
                title="flying"
            /></label>
          </p>

          <p>Games to include:</p>
          <p>
            <label
              ><input
                type="checkbox"
                id="games-all"
                class="select-all hideCheckbox"
                value="games"
              />
              <img src="static/images/select-all-select-all.png" alt="select all" class="orb"></label
            >
            <label
              ><input
                type="checkbox"
                class="games hideCheckbox"
                value="shadow dragon"
                checked="" />
              <img
                src="static/images/games-shadow-dragon.png"
                alt="Shadow Dragon icon"
                title="Shadow Dragon / Mystery pt. 1"
            /><span class="label-text"></span></label>
            <label
              ><input
                type="checkbox"
                class="games hideCheckbox"
                value="new mystery"
                checked="" />
              <img
                src="static/images/games-new-mystery.png"
                height="30px"
                alt="New Mystery of the Emblem icon"
                title="New Mystery / Mystery pt. 2"
            /><span class="label-text"></span></label>
            <label
              ><input
                type="checkbox"
                class="games hideCheckbox"
                value="valentia"
                checked="" />
              <img
                src="static/images/games-valentia.png"
                alt="Echoes: Shadows of Valentia icon"
                title="Echoes: Shadows of Valentia / Gaiden"
            /><span class="label-text"></span></label>
            <label
              ><input
                type="checkbox"
                class="games hideCheckbox"
                value="genealogy"
                checked="" />
              <img
                src="static/images/games-genealogy.png"
                alt="Genealogy of the Holy War icon"
                title="Genealogy of the Holy War"
            /><span class="label-text"></span></label>
            <label
              ><input
                type="checkbox"
                class="games hideCheckbox"
                value="thracia"
                checked="" />
              <img src="static/images/games-thracia.png" alt="Thracia 776 icon" title="Thracia 776"
            /><span class="label-text"></span></label>
            <label
              ><input
                type="checkbox"
                class="games hideCheckbox"
                value="binding blade"
                checked="" />
              <img
                src="static/images/games-binding-blade.png"
                alt="Binding Blade icon"
                title="Binding Blade"
            /><span class="label-text"></span></label>
            <label
              ><input
                type="checkbox"
                class="games hideCheckbox"
                value="blazing blade"
                checked="" />
              <img
                src="static/images/games-blazing-blade.png"
                alt="Blazing Blade icon"
                title="Blazing Blade"
            /><span class="label-text"></span></label>
            <label
              ><input
                type="checkbox"
                class="games hideCheckbox"
                value="sacred stones"
                checked="" />
              <img
                src="static/images/games-sacred-stones.png"
                alt="Sacred Stones icon"
                title="Sacred Stones"
            /><span class="label-text"></span></label>
            <label
              ><input
                type="checkbox"
                class="games hideCheckbox"
                value="path of radiance"
                checked="" />
              <img
                src="static/images/games-path-of-radiance.png"
                alt="Path of Radiance icon"
                title="Path of Radiance"
            /><span class="label-text"></span></label>
            <label
              ><input
                type="checkbox"
                class="games hideCheckbox"
                value="radiant dawn"
                checked="" />
              <img
                src="static/images/games-radiant-dawn.png"
                alt="Radiant Dawn icon"
                title="Radiant Dawn"
            /><span class="label-text"></span></label>
            <label
              ><input
                type="checkbox"
                class="games hideCheckbox"
                value="awakening"
                checked="" />
              <img src="static/images/games-awakening.png" alt="Awakening icon" title="Awakening"
            /><span class="label-text"></span></label>
            <label
              ><input type="checkbox" class="games hideCheckbox" value="fates" checked="" />
              <img src="static/images/games-fates.png" alt="Fates icon" title="Fates"
            /><span class="label-text"></span></label>
            <label
              ><input
                type="checkbox"
                class="games hideCheckbox"
                value="three houses"
                checked="" />
              <img
                src="static/images/games-three-houses.png"
                alt="Three Houses icon"
                title="Three Houses"
            /><span class="label-text"></span></label>
            <label
              ><input
                type="checkbox"
                class="games hideCheckbox"
                value="fewth"
                checked="" />
              <img
                src="static/images/games-three-hopes.png"
                height="30px"
                alt="Warriors: Three Hopes icon"
                title="Warriors: Three Hopes"
            /><span class="label-text"></span></label>
            <label
              ><input
                type="checkbox"
                class="games hideCheckbox"
                value="engage"
                checked="" />
              <img
                src="static/images/games-engage.png"
                height="30px"
                alt="Engage icon"
                title="Engage"
            /><span class="label-text"></span></label>
            <label
              ><input type="checkbox" class="games hideCheckbox" value="heroes" checked="" />
              <img src="static/images/games-heroes.png" alt="Heroes icon"
            /><span class="label-text"></span></label>
            <label
              ><input
                type="checkbox"
                class="games hideCheckbox"
                value="warriors"
                checked="" />
              <img
                src="static/images/games-warriors.png"
                height="28px"
                alt="Warriors icon"
                title="Warriors"
            /><span class="label-text"></span></label>
            <label
              ><input type="checkbox" class="games hideCheckbox" value="tms" checked="" />
              <img
                src="static/images/games-tms.png"
                alt="Tokyo Mirage Sessions #FE icon"
                title="Tokyo Mirage Sessions #FE"
            /></label>
            <span class="help-text">
              <a href="#game-toggle" class="toggle">(About Games)</a>
              <div id="game-toggle" >
              A unit's game is mostly decided here the same way that it is in Heroes.
              So, if a character is from more than one game, i.e. the Whitewings,
              the Greil mercenaries, etc., they are only counted as being from
              whichever game Heroes designated. With the Archanea games, I've separated out 
              the characters that are ONLY from the second half of Mystery of the Emblem / from New Mystery of
              the Emblem, but if you want to see all the Archanea units, just check both boxes.
              ⚠️ For right now, duo units are only classified under the lead
              character's game. ⚠️ The Warriors option is only aspirational and likely to remain so eternally.
            </div></span>
          </p>
          <p>Types of units to include:</p>
          <p>
            <label>
              <input
                type="checkbox"
                id="variety-all"
                class="select-all hideCheckbox"
                value="variety"
              />
              <img src="static/images/select-all-select-all.png" alt="select all" class="orb">
            </label>
            <label>
              <input
                type="checkbox"
                class="variety"
                value="base"
                checked=""
              />
              Base
            </label>
            <label>
              <input
                type="checkbox"
                class="variety"
                value="fallen"
                checked=""
              />
              Fallen
            </label>
            <label>
              <input
                type="checkbox"
                class="variety"
                value="brave"
                checked=""
              />
              Brave
            </label>
            <label
              ><input
                type="checkbox"
                class="variety"
                value="legendary"
                checked=""
              />
              Legendary
            </label>
            <label
              ><input
                type="checkbox"
                class="variety"
                value="mythic"
                checked=""
              />
              Mythic
            </label>
            </label>
            <label>
              <input
                type="checkbox"
                class="variety"
                value="kaika"
                checked=""
              />
              Ascended
            </label>
            <label>
            <input
              type="checkbox"
              class="variety"
              value="rearmed"
              checked=""
            />
              Rearmed
            </label>
            <label><input type="checkbox" class="variety" value="kyoushin" checked=""/>Attuned</label>
            <label><input type="checkbox" class="variety" value="aided" checked=""/>Aided</label>
            <label><input type="checkbox" class="variety" value="emblem" checked="">Emblem</label>
            <label><input type="checkbox" class="variety" value="special" checked=""/>Special</label>
            <label><input type="checkbox" class="variety" value="misc" checked=""/>Misc.</label>
          </p>
          <p>
            Types of specials to include:
            </p>
            <p>
            <label><input type="checkbox" id="specials-all" class="select-all hideCheckbox" value="specials"/>
              <img src="static/images/select-all-select-all.png" alt="select all" class="orb">
            </label>
            <label><input type="checkbox" class="specials" value="adrift" checked=""/>Adrift</label>
            <label><input type="checkbox" class="specials" value="autumn" checked=""/>Autumn (harvest festival)</label>
            <label><input type="checkbox" class="specials" value="child" checked=""/>Child</label>
            <label><input type="checkbox" class="specials" value="cultural festival" checked=""/>Cultural Festival (desert)</label>
            <label><input type="checkbox" class="specials" value="devoted" checked=""/>Devoted</label>
            <label><input type="checkbox" class="specials" value="hotspring" checked=""/>Hotspring</label>
            <label><input type="checkbox" class="specials" value="new year" checked=""/>New Year</label>
            <label><input type="checkbox" class="specials" value="ninja" checked=""/>Ninja</label>
            <label><input type="checkbox" class="specials" value="performer" checked=""/>Performing Arts</label>
            <label><input type="checkbox" class="specials" value="picnic/teatime" checked=""/>Picnic/Teatime</label>
            <label><input type="checkbox" class="specials" value="pirate/bandit" checked=""/>Pirate/Bandits</label>
            <label><input type="checkbox" class="specials" value="scion" checked=""/>Scion</label>
            <label><input type="checkbox" class="specials" value="spring" checked=""/>Spring (bunnies)</label>
            <label><input type="checkbox" class="specials" value="summer" checked=""/>Summer (beach)</label>
            <label><input type="checkbox" class="specials" value="wedding" checked=""/>Wedding</label>
            <label><input type="checkbox" class="specials" value="winter" checked=""/>Winter</label>
            <label><input type="checkbox" class="specials" value="none" checked=""/>(Uncheck this to filter out all non-special units)</label>
          </p>

          <p>Types of characters to include:</p>
          <p>
            <label><input type="checkbox" id="storyRoles-all" class="select-all hideCheckbox" value="storyRoles"/>
              <img src="static/images/select-all-select-all.png" alt="select all" class="orb">
            </label>
            <label><input type="checkbox" class="storyRoles" value="mc" checked=""/>Protagonists/Player avatars</label>
            <label><input type="checkbox" class="storyRoles" value="pc" checked=""/>Other PCs</label>
            <label><input type="checkbox" class="storyRoles" value="npc" checked=""/>NPCs</label>
            <label><input type="checkbox" class="storyRoles" value="lore" checked=""/>lore</label>
          </p>
<!-- 
          <p>⚠️UNDER CONSTRUCTION⚠️ Summoning probabilities to include:</p>
          <p>
            <label>
              <input type="checkbox" id="rarities-all" class="select-all" value="rarities"/>
              <img src="static/images/select-all-select-all.png" alt="select all" class="orb">
            </label>

            <label><input type="checkbox" class="rarities hideCheckbox" value="story" checked="" />Story units (not summonable)</label>
            <label><input type="checkbox" class="rarities hideCheckbox" value="4s" checked="" />3-4 stars</label>
            <label><input type="checkbox" class="rarities hideCheckbox" value="4s into 5s" checked="" />4 stars changed into 5 stars</label>
            <label><input type="checkbox" class="rarities hideCheckbox" value="5s" checked="" />5 (*including specials for now)</label>
            <label><input type="checkbox" class="rarities hideCheckbox" value="special" checked="" />[4 stars changed to 5 stars special / 4-5 stars special]</label>
            <label><input type="checkbox" class="rarities hideCheckbox" value="grails" checked="" />Grand hero battle/tempest trial (not summonable)</label>
          </p> -->

          <p>Versions to include:</p>
          <p>
            <label>
              <input type="checkbox" id="versions-all" class="select-all hideCheckbox" value="versions"/>
              <img src="static/images/select-all-select-all.png" alt="select all" class="orb">
            </label>
            <label>
              <input type="checkbox" class="versions" value="1" checked=""/>
              1
            </label>
            <label>
              <input type="checkbox" class="versions" value="2" checked=""/>
              2
            </label>
            <label>
              <input type="checkbox" class="versions" value="3" checked=""/>
              3
            </label>
            <label>
              <input type="checkbox" class="versions" value="4" checked=""/>
              4
            </label>
            <label>
              <input type="checkbox" class="versions" value="5" checked=""/>
              5
            </label>
            <label>
              <input type="checkbox" class="versions" value="6" checked=""/>
              6
            </label>
            <label>
              <input type="checkbox" class="versions" value="7" checked=""/>
              7
            </label>
            <label>
              <input type="checkbox" class="versions" value="8" checked=""/>
              8
            </label>

            <p>Other Filters:</p>
            
            <label>
              <input type="checkbox" id="refreshers" /> Refreshers only</label>
            <span class="help-text hide-help"
              >Check to see only units who can grant other units another turn
              with assist skills (dance/sing/chant/play/etc.). (Units who can
              only grant other units another action with duo skills are not 
              included.)
            </span>

            <label>
              <input type="checkbox" id="duos" /> Duos only</label>
            <span class="help-text hide-help"
              >Check to see only units classified as duo or harmonized.
            </span>

            <label
              ><input type="checkbox" id="altHell" />Alt Hell</label>
            <span class="help-text hide-help">
              Check to see only units whose character doesn't have a base unit yet.
            </span>

            <label
              ><input type="checkbox" id="grails" /> Grail units only</label>
            <span class="help-text hide-help"
              >If checked, only units from Grand Hero Battles and Tempest Trials
              will appear.
            </span>

            <label
              ><input type="checkbox" id="resplendentsOnly" /> Resplendents Only</label>
            <span class="help-text hide-help"
              >If checked, only units with a resplendent version will appear. Note that this is different than "resplendent mode."
            </span>

          <!-- <label>
            <input type="checkbox" id="exclude" /> Exclude secondary types for bases</label>
              <span class="help-text hide-help">
                In this picker, "base" is defined as "unit who debuted in their default outfit with default weapon". 
                This means that some units counted as base units have other characteristics: 
                Fjorm: Princess of Ice is counted as base/legendary, 
                Duma: God of Strength is counted as base/mythic, 
                Alfred: Floral Protector is counted as base/rearmed, etc. 
                Therefore, if you have only "base" checked in the "types of units to include" section, 
                these units will still show up. 
                Check this box if you would like to EXCLUDE all legendary/mythic/rearmed units. 
                (Note: Checking this will override the other checkboxes that include them.)
              </span> -->

          <!-- <p>
            <label
              ><input type="checkbox" id="spoilers" /> Include spoilers</label>
            <span class="help-text hide-help"
              >If unchecked, units that might be considered spoilers, either for
              story reasons or because they're officially unreleased, will be
              excluded.</span>
              <p> -->

                
              </p>
          </p>
        </div>
        <!-- end filters -->
        <!-- start display options -->
        
        <div id="options" style="display: none">

          <p>
            <label><input type="checkbox" id="portrait" />
              portrait mode
            </label>
            <span class="help-text">
              If checked, units will display in portrait mode instead of full-artwork mode
            </span>
          </p>

          <p>
            <label
              ><input type="checkbox" id="resplendent" /> resplendent
              mode</label>
            <span class="help-text"
              >If checked, any units with a resplendent version will display
              their resplendent artwork.</span
            >
          </p>

        <!-- <p>
          <label>
            <input type="checkbox" id="view-name" onclick="viewName()"/> Display unit name</label>
          <span class="help-text">
            Display names of units on top of unit image (BETA)</span>
        </p> -->
        <!-- script to toggle display text for units -->
        <script>
          function viewName() {
            const viewNameCheckbox = document.getElementById('view-name')
            console.log(viewNameCheckbox.checked);
            const nameDisplay = document.getElementsByClassName('floatText')
            for (i = 0; i < nameDisplay.length; i++) {
              // console.log(nameDisplay[i].style.display)
              if (viewNameCheckbox.checked) {
                console.log('text');
                nameDisplay[i].style.display = 'block';
              } else {
                console.log('no text');
                nameDisplay[i].style.display = 'none';
          }}}
        </script>

        <label>
          Maximum batch size:
          <input type="number" id="max-batch-size" value="20" min="2" max="20" step="1"/>
        </label>
        <span class="help-text">
          The maximum number of units shown at a time. When there are few
          units left in a round, you'll see fewer than this. Reducing the
          maximum batch size may make it easier to pick, but it will also
          take longer to get through each round.
        </span>
        </div>
        <!-- end display options -->
        <!-- start explanation -->
        <div id="explanation" style="display: none">
          <p>
            Original script from https://github.com/antialiasis/favorite-picker
          </p>
          <p>
            Images from Fire Emblem Heroes Wiki
          </p>

          <p>Original description from antialiasis's picker code:</p>
          
          <p>
            "For each group of units presented to you, click one or more of your
            favorites from that group and press the "Pick" button. Eventually, your
            favorite unit will start appearing under "Found Favorites". You can
            continue as long as you like to construct an arbitrarily long list of your
            favorite units.
          </p>
      
          <p>
            "In principle, this picker is perfectly accurate, provided you pick
            consistently - you'll correctly get your second favorite second, even if
            it's pitted against your absolute favorite early on, for instance.
            <!-- <a href="#howitworks" class="toggle"
              >Click here for more on how this tool works.</a
            > -->
            You can reorder your favorites after you've found them, but in principle
            you shouldn't need to.
          </p>
      
          <p>
            "Various filtering and presentation options for the picker can be found in
            the "Options" tab.
          </p>
      
          <p>
            "Want to create your own favorite picker?
            <a href="https://github.com/antialiasis/favorite-picker"
              >It's on GitHub with instructions to get you started."</a
            >
          </p>
        </div>
        <!-- end explanation -->
        <!-- start update log -->
        <!-- <div id="updates" style="display: none">
          <div id="updates-background">
            <p>
              2024/10/24
              <ul>
                <li>updated unit list</li>
                <li>"aided" filter is now working</li>
              </ul>
              To fix:
                <ul>
                <li>the units just added have no artwork (just the most recent banner with aided Dagr)</li>
                <li>"Rarity" filter is functioning but units' rarities have not been updated</li>
              </ul>
            </p>
            <p>
              2024/9/26
              <ul>
                <li>updated unit list</li>
              </ul>
              To fix:
                <ul>
                <li>the units just added mostly have not had artwork added yet</li>
                <li>"aided" heroes currently appear under "attuned"</li>
              </ul>
            </p>
            <p>
              2024/1/13
              <ul>
                <li>Version 1.0: Specials filter added</li>
              </ul>
            </p>
            <p>
              2024/1/5
              <ul>
                <li>New filter added: version 8</li>
                <li>New units added: Ring In the Year banner + tempest trials</li>
              </ul>
            </p>
            <p>
              2023/12/27
              <ul>
                <li>New resplendent added: Ilyana FE09 base</li>
                <li>Fixed: several units weapons, move types, names</li>
              </ul>
            </p>
            <p>
              2023/12/26
              <ul>
                <li>New feature: Update list tab</li>
                <li>New unit added: Camilla legendary</li>
              </ul>
            </p>
          </div>
        </div> -->
        <!-- end update log -->
      </div>
    </div>

    <div id="shared-list-modal" style="display: none">
        <button class="close shared-list-skip">×</button>
        <h2>Shared list</h2>

        <p>
            Generated by this picker tool. Create your own list or continue from this one below!
        </p>

        <ol id="shared-list" class="item-list"></ol>

        <p class="buttons">
            <button id="shared-list-continue">Continue from this list</button>
            <button class="shared-list-skip">Make my own list</button>
        </p>
    </div>

    <script src="picker/jquery-1.10.2.min.js"></script>
    <script src="picker/picker.js?v=1"></script>
    <script src="picker/picker-ui.js"></script>
    <script src="picker/Sortable.min.js"></script>

    <script>
      "use strict";

      /* UNIT DATA CONSTANTS */

      var lists = {
        weaponTypes: [
          "sword",
          "lance",
          "axe",
          "staff",
          "dark",
          "light",
          "anima",
          "tome",
          "bow red",
          "bow blue",
          "bow green",
          "bow colorless",
          "dagger red",
          "dagger blue",
          "dagger green",
          "dagger colorless",
          "beast red",
          "beast blue",
          "beast green",
          "beast colorless",
          "dragon red",
          "dragon blue",
          "dragon green",
          "dragon colorless",
        ],
        games: [
          "shadow dragon",
          "new mystery",
          "valentia",
          "genealogy",
          "thracia",
          "binding blade",
          "blazing blade",
          "sacred stones",
          "path of radiance",
          "radiant dawn",
          "awakening",
          "fates",
          "three houses",
          "fewth",
          "engage",
          "heroes",
          "warriors",
          "tms"
        ],
        minorFormTypes: ["alternate", "battle", "gender", "aesthetic"],
        moveTypes: ["infantry", "armored", "cavalry", "flying"],
        storyRoles: ["mc", "pc", "npc", "lore"],
        versions: ["1", "2", "3", "4", "5", "6", "7", "8"],
        variety: [
          "base",
          "fallen",
          "brave",
          "legendary",
          "mythic",
          "kaika",
          "rearmed",
          "kyoushin",
          "aided",
          "emblem",
          "special",
          "misc",
        ],
        specials: [
          "spring", 
          "summer", 
          "autumn", 
          "winter", 
          "devoted", 
          "new year", 
          "cultural festival",
          "ninja",
          "performer",
          "picnic/teatime", 
          "pirate/bandit", 
          "wedding",
          "adrift",
          "hotspring", 
          "scion",
          "child",
          "none"
        ],
        // rarities: ["story", "4s", "4s into 5s", "5s", "grails", "special"]
      };

      var defaultSettings = {
        resplendent: false,
        portrait: false,
        includeForms: [],
        majorOnly: false,
        refreshersOnly: false,
        duosOnly: false,
        altHell: false,
        grailsOnly: false,
        resplendentsOnly: false,
        exclude: false,
        spoilers: true,
        weaponTypes: lists.weaponTypes,
        moveTypes: lists.moveTypes,
        storyRoles: lists.storyRoles,
        versions: lists.versions,
        variety: lists.variety,
        specials: lists.specials,
        // rarities: lists.rarities,
        dummyAtt: lists.dummyAtt,
        games: lists.games,
        maxBatchSize: 20,
      };

      var fehPicker = new picker.Picker({

        defaultSettings: defaultSettings,
        localStorageKey: "favorites",
        favoritesQueryParam: "favs",
        shortcodeLength: 2,

        modifyState: function (state) {
          var legacyReplacements = {
            "306f": "306mega",
            "71810-percent": "718tenpercent",
            "890gigantamax": "890eternamax",
          };

          if (state.found_favorites) {
            state.favorites = state.found_favorites;
            delete state.found_favorites;
          }

          var survived = state.survived;
          var eliminated = state.eliminated;
          var evaluating = state.evaluating;
          var current = state.current;
          var favorites = state.favorites;
          
          var arrays = [favorites, survived, eliminated, current, evaluating];

          var identifier;
          var i, j;

          if (!state.settings) {
            // Backwards-compatibility: old states since before settings became a sub-object
            state.settings = {
                resplendent: state.resplendent,
                portrait: state.portrait,
                includeForms: state.include_forms ? lists.includeForms : [],
                spoilers: state.spoilers,
                // finalOnly: state.final_only,
                // We want major only checked by default for users who weren't including forms before, so as to make it the default in forms mode
                majorOnly: state.major_only === undefined && !state.include_forms ? true : state.major_only || true,
                // Default to all generations/types checked.
                weaponTypes: state.weaponTypes || lists.weaponTypes,
                moveTypes: state.moveTypes || lists.moveTypes,
                games: state.games || lists.games,
                variety: state.variety || lists.variety,
                specials: state.specials || lists.specials,
                version: state.verskion || lists.version,
                // rarities: state.rarities || lists.rarities,
                dummyAtt: state.dummyAtt || lists.dummyAtt,
                maxBatchSize: state.max_batch_size || defaultSettings.maxBatchSize
            };
        } else {
            // Backwards-compatibility: ensure we have the camelCase settings (and no extra settings)
            state.settings = {
                shiny: state.settings.shiny,
                includeForms: state.settings.includeForms || (state.settings.include_forms ? lists.includeForms : []),
                spoilers: state.settings.spoilers,
                // finalOnly: state.settings.finalOnly || state.settings.final_only,
                majorOnly: state.settings.majorOnly || state.settings.major_only,
                // generations: state.settings.generations,
                weaponTypes: state.settings.weaponTypes,
                types: state.settings.types,
                maxBatchSize: state.settings.maxBatchSize || state.settings.max_batch_size
            };
        }

        if (typeof state.settings.includeForms !== 'object') {
            state.settings.includeForms = state.settings.includeForms ? lists.includeForms : [];
        }

        for (i = eliminated.length - 1; i >= 0; i--) {
            for (j = eliminated[i].eliminatedBy.length - 1; j >= 0; j--) {
                if (eliminated[i].eliminatedBy[j] in legacyReplacements) {
                    eliminated[i].eliminatedBy[j] = legacyReplacements[eliminated[i].eliminatedBy[j]];
                }
            }
        }
        return state;
        },
        settingsFromFavorites: function (favorites) {
          var settings = {
            //   includeForms: [],
            majorOnly: true,
            spoilers: false,
          };
          var i, j;
          var formTypes;
          var formType;

          for (i = 0; i < favorites.length; i++) {
            // Enable spoilers if the unit is a spoiler.
            if (favorites[i].spoiler) {
              settings.spoilers = true;
            }
          }
          return settings;
        },
        shouldIncludeItem: function (item, settings) {
          var key;
          for (key in settings) {
            if (settings.hasOwnProperty(key)) {
              if (!settingIncludesUnits(item, key, settings)) {
                return false;
              }
            }
          }
          return true;
        },
        onLoadState: function (missingItems, extraItems) {
          var addedSpoilers = false;
          var i;

          var settings = this.getSettings();

          if (missingItems.length && settings.spoilers) {
            for (i = 0; i < missingItems.length; i++) {
              if (this.itemMap[missingItems[i]].spoiler) {
                // We've added a spoiler
                addedSpoilers = true;
              }
            }
            if (
              addedSpoilers &&
              !confirm(
                "Some units marked as spoilers have been added since last time you were here. Press OK to proceed with these units added. Press Cancel to turn off spoilers so that you won't see these units."
              )
            ) {
              settings.spoilers = false;
              this.setSettings(settings);
            }
          }
          $(function () {
            var $welcome = $(
              '<p class="info">Welcome back! Your previous state has been loaded. If you would like to start from scratch, please click this button: </p>'
            ).append(pickerUI.makeResetButton());
            $("h2").next(".info").remove();
            $("h2").after($welcome);
          });
        },
      });

      var pickerUI = new PickerUI(fehPicker, {
        elements: {
          settings: {
            resplendent: "#resplendent",
            // finalOnly: "#final",
            // majorOnly: "#major",
            portrait: "#portrait",
            refreshersOnly: "#refreshers",
            duosOnly: "#duos",
            altHell: "#altHell",
            grailsOnly: "#grails",
            resplendentsOnly: "#resplendentsOnly",
            exclude: "#exclude",
            weaponTypes: ".weaponTypes",
            moveTypes: ".moveTypes",
            storyRoles: ".storyRoles",
            versions: ".versions",
            games: ".games",
            variety: ".variety",
            specials: ".specials",
            // rarities: ".rarities",
            dummyAtt: ".dummyAtt",
            spoilers: "#spoilers",
            maxBatchSize: "#max-batch-size",
          },
          pick: "#pick",
          pass: "#pass",
          undo: "#undo",
          redo: "#redo",
          reset: ".reset",
          evaluating: "#units",
          favorites: "#favorites",
          sharedList: "#shared-list",
          sharedListContainer: "#shared-list-modal",
          sharedListContinue: "#shared-list-continue",
          sharedListSkip: ".shared-list-skip",
        },
        messages: {
          mustSelect:
            "You must select some units first! If you like them all the same, press Pass.",
          orderedAll: "You have ordered every available unit!",
          noItems:
            "There are no units that fit your criteria! Set some different options and try again.",
        },
        onUpdate: function (updateType) {
          var totalUnits = this.picker.state.items.length;
          var current = this.picker.state.arrays.current.length;
          var favorites = this.picker.state.arrays.favorites.length;
          var eliminated = this.picker.state.arrays.eliminated.length;
          var evaluating = this.picker.state.arrays.evaluating.length;
          var remaining = Math.max(0, totalUnits - favorites - eliminated - 1);

          setPickerWidth();

          $("#remaining").text(remaining);

          updateProgressBar(
            (1 - remaining / this.picker.state.roundSize) * 100,
            updateType
          );

          $("#found-favorites").find("p.state-info").remove();

          if (favorites === 0) {
            $("#found-favorites").prepend(
              '<p class="state-info">None yet! Your favorites will start appearing here when you\'ve narrowed things down.</p>'
            );
          } else {
            $("#dispute").after(
              '<p class="state-info"><a href="/favorite-list' +
                this.picker.getShortcodeLink() +
                (this.picker.state.settings.resplendent
                  ? "&resplendent=1"
                  : "") +
                "\">Shareable link to your current favorites list.</a> Note that that page won't automatically update as you go; you'll have to share a new link when you've found more favorites.</p>"
            );
          }

          $("#debug-state").val(
            JSON
              ? JSON.stringify(this.picker.state.getState())
              : "Your browser does not support native JSON serialization! Unfortunately, at the moment you cannot use the import/export feature."
          );
        },
        wrapItem: function (item) {
          return $("<li></li>").append($("<span></span>").append(item));
        },
        
        getItemImageUrl: function (unit, settings) {
          return (
            "static/images/" +
            (settings.portrait
              ? "portraits/"
              : "") +
            unit.id +
            (settings.resplendent && unit.hasOwnProperty("resplendent")
              ? "-r"
              : "") +  
            (settings.portrait
              ? "-p"
              : "") +  
            ".png"
          );
        },
      });

      $.getJSON("static/units.json", function (json) {
        fehPicker.options.items = json.items;
        fehPicker.initialize();

        pickerUI.initialize();

        pickerUI.elem.settings.weaponTypes.on("change", function () {
          setSelectAll("weaponTypes");
        });

        pickerUI.elem.settings.moveTypes.on("change", function () {
          setSelectAll("moveTypes");
        });

        pickerUI.elem.settings.games.on("change", function () {
          setSelectAll("games");
        });

        pickerUI.elem.settings.storyRoles.on("change", function () {
          setSelectAll("storyRoles");
        });

        pickerUI.elem.settings.versions.on("change", function () {
          setSelectAll("versions");
        });

        pickerUI.elem.settings.variety.on("change", function () {
          setSelectAll("variety");
        });

        pickerUI.elem.settings.specials.on("change", function () {
          setSelectAll("specials");
        });

        // pickerUI.elem.settings.rarities.on("change", function () {
        //   setSelectAll("rarities");
        // });

        pickerUI.elem.settings.dummyAtt.on("change", function () {
          setSelectAll("dummyAtt");
        });

        setSelectAll("weaponTypes");
        setSelectAll("moveTypes");
        setSelectAll("games");
        setSelectAll("storyRoles");
        setSelectAll("versions");
        setSelectAll("variety");
        setSelectAll("specials");
        // setSelectAll("rarities");
        setSelectAll("dummyAtt");
      });

      /* SORTABLE FAVORITES */

      var sortable = new Sortable(pickerUI.elem.favorites.get(0), {
        draggable: ".item",
        animation: 100,
        onStart: function () {
          pickerUI.elem.favorites.addClass("sorting");
        },
        onEnd: function () {
          pickerUI.elem.favorites.removeClass("sorting");
        },
        onUpdate: function () {
          fehPicker.setFavorites(
            pickerUI.elem.favorites
              .children()
              .map(function () {
                return pickerUI.getItem(this);
              })
              .get()
          );
          pickerUI.update(true, "sort");
        },
      });

      /* PROGRESS BAR */

      function updateProgressBar(value, updateType) {
        var $progressBar = $("#progress-bar span");
        var $favorite;

        if (["pick", "undo", "redo"].indexOf(updateType) !== -1) {
          if (!value && updateType !== "undo") {
            // We just found a favorite!
            $favorite = pickerUI.elem.favorites
              .children("li")
              .last()
              .addClass("no-animate hidden");
            $progressBar.animate({ width: "100%" }, 400, function () {
              $progressBar.parent().css({ transform: "scale(1.1)" });
              setTimeout(function () {
                $progressBar.parent().css({ transform: "scale(1)" });
                $progressBar.width(0);
                $favorite.removeClass("no-animate hidden");
              }, 200);
            });
          } else {
            if (!$progressBar.width() && updateType === "undo") {
              $progressBar.width("100%");
            }
            $progressBar.animate({ width: value + "%" }, 400);
          }
        } else {
          $progressBar.width(value + "%");
        }
      }

      /* ADDITIONAL PICKER EVENT HANDLERS */

      function setSelectAll(setting) {
        const value = pickerUI.getSetting(setting);
        const selectAll = $('.select-all[value="' + setting + '"]');
        const newValue = value.length === lists[setting].length;
        selectAll.prop("checked", newValue);
      }

      $(".select-all").on("change", function () {
        const setting = $(this).val();
        const values = $(this).prop("checked") ? lists[setting] : [];
        console.log(`.select-all.on('change'): setting=${setting}, values=${values}`);
        pickerUI.setSetting(setting, values);
        fehPicker.setSettings(pickerUI.getSettings());
        pickerUI.update(true, "setting");
      });

      $("#import").on("click", function () {
        var state;

        try {
          state = JSON.parse($("#debug-state").val().trim());
        } catch (e) {
          $("#debug-state").val("Invalid import state.");
          return false;
        }

        if (!fehPicker.setState(state)) {
          $("#debug-state").val("Invalid import state.");
        }

        pickerUI.update(false, "import");
        return false;
      });

      $(window).on("resize", setPickerWidth);

      /* NON-PICKER EVENT HANDLERS */

      $(".toggle").on("click", function () {
        $($(this).attr("href")).slideToggle();
        return false;
      });

      $(".tabs").each(function () {
        var $tabs = $(this);
        $tabs
          .find("a:not(#expand-favorites a)")
          .on("click", function () {
            $(
              $tabs
                .children(".active")
                .removeClass("active")
                .children("a")
                .attr("href")
            ).hide();
            $(this).parent().addClass("active");
            $($(this).attr("href")).show();
            return false;
          })
          .each(function () {
            $($(this).attr("href")).hide();
          })
          .first()
          .click();
      });

      $("#expand-favorites a").on("click", function () {
        $(this).html(
          $("#secondary").hasClass("expanded") ? "&lsaquo;" : "&rsaquo;"
        );
        $(this).attr(
          "title",
          $("#secondary").hasClass("expanded") ? "Expand list" : "Show picker"
        );
        $("#picking").toggleClass("collapsed");
        $("#secondary").toggleClass("expanded");
        return false;
      });

      $("#darkmode").on("click", function () {
        if (getActiveStyleSheet() === "dark") {
          setActiveStyleSheet(null);
          $(this).text("Dark mode");
        } else {
          setActiveStyleSheet("dark");
          $(this).text("Light mode");
        }
        return false;
      });

      if (getActiveStyleSheet() === "dark") {
        $("#darkmode").text("Light mode");
      }

      /* UTILITY FUNCTIONS */

      function setPickerWidth() {
        var evaluating = fehPicker.state.arrays.evaluating;
        pickerUI.elem.evaluating.width(
          evaluating.length
            ? getBatchWidth(evaluating.length, 5) *
                (pickerUI.elem.evaluating.children().width() + 6)
            : "100%"
        );
      }

      function settingIncludesUnits(unit, setting, settings) {
        /**
         * Returns false if the unit should be filtered out by the given
         * setting, or true otherwise.
         */
        var value = settings[setting];
        // console.log('>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>');
        // console.log('this is unit:');
        // console.log(unit);
        // console.log('this is setting:');
        // console.log(setting);
        // console.log('this is settings:');
        // console.log(settings);
        // console.log('this is value:');
        // console.log(value);
        switch (setting) {
          case "weaponTypes":
            return value.indexOf(unit.weaponType) !== -1;
          case "moveTypes":
            return value.indexOf(unit.moveType) !== -1;
          case "games":
            return value.indexOf(unit.game) !== -1 || value.indexOf(unit.game2) !== -1;
          case "storyRoles":
            return value.indexOf(unit.storyRole) !== -1;
          case "versions":
            return value.indexOf(unit.version) !== -1;
          case "variety":
            return value.indexOf(unit.variety) !== -1 || value.indexOf(unit.variety2) !== -1;
          case "specials":
            return value.indexOf(unit.special) !== -1;
          // case "rarities":
          //   return value.indexOf(unit.rarity) !== -1;
          case "refreshersOnly":
            return !value || unit.refresher === true;
          case "duosOnly":
            return !value || unit.duo === "duo" || unit.duo === "harmonized";
          case "altHell":
            return !value || unit.altHell === true;
          case "grailsOnly":
            return !value || unit.grails === "ghb" || unit.grails === "tt";
          case "resplendentsOnly":
            return !value || unit.hasOwnProperty("resplendent");
          case "exclude":
            return !value || unit.variety2 === "base";
          case "spoilers":
            return value || !unit.spoiler;
          default:
            return true;
        }
      }

      function getBatchWidth(batchSize, maxWidth) {
        /**
         * Calculate how many sprites wide the display area for the unit
         * should be, for the given batch size.
         * We want the closest thing possible to a square, but prefer perfect
         * rectangles to imperfect squares.
         */
        // First, factor the batch size.
        var root = Math.sqrt(batchSize);
        var i,
          factor = 1;
        for (i = 2; i <= root; i++) {
          // The highest number up to i that batchSize is divisible by is factor.
          if (batchSize % i === 0) {
            factor = i;
          }
        }
        // If this would lead to the width being more than three times greater than the height, 
        // use the same batch width as the number above.
        if (3 * factor < batchSize / factor) {
          return getBatchWidth(batchSize + 1, maxWidth);
        } else {
          return Math.min(5, batchSize / factor);
        }
      }

      function prettyJoin(array, word) {
        /**
         * Joins the array items together in a human way: "a, b and c"
         *
         * word can optionally be set to use a different word than 'and' for
         * the final item.
         */
        if (!word) word = " and ";
        if (array.length === 1) {
          return array[0];
        } else {
          return (
            array.slice(0, array.length - 1).join(", ") +
            word +
            array[array.length - 1]
          );
        }
      }

      function hasMinorForms(forms) {
        /**
         * Returns true if any of the given forms can be minor.
         */
        for (var i = 0; i < lists.minorFormTypes.length; i++) {
          if (forms.indexOf(lists.minorFormTypes[i]) !== -1) {
            return true;
          }
        }
        return false;
      }

      /* CONSOLE TESTS */

      function createShortcode(num) {
        var alphabet =
          "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";
        return alphabet[Math.floor(num / 64)] + alphabet[num % 64];
      }

      function testShortcodes() {
        var firstForm = null;
        for (var i = 0; i < items.length; i++) {
          if (firstForm === null && items[i].form) {
            firstForm = i;
          }
          var expectedShortcode = createShortcode(
            firstForm !== null ? i - firstForm + 2500 : i
          );
          if (expectedShortcode !== items[i].shortcode) {
            console.log(
              "Unexpected shortcode! Expected:",
              expectedShortcode,
              items[i]
            );
          }
        }
      }

      function testFormTypes() {
        var formTypes;
        var formTypeMap = {};
        var i, j;
        for (i = 0; i < items.length; i++) {
          if (!items[i].form) {
            continue;
          }
          formTypes = items[i].formType.split(",");
          for (j = 0; j < formTypes.length; j++) {
            formTypeMap[formTypes[j]] = true;
          }
        }

        console.log(Object.keys(formTypeMap).sort());
      }

    </script>
  </body>
</html>